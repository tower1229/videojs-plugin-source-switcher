(function(c,a){typeof exports=="object"&&typeof module!="undefined"?module.exports=a(require("video.js")):typeof define=="function"&&define.amd?define(["video.js"],a):(c=typeof globalThis!="undefined"?globalThis:c||self,c.lib=a(c.videojs))})(this,function(c){"use strict";function a(i){return i&&typeof i=="object"&&"default"in i?i:{default:i}}var o=a(c);const b=o.default.getComponent("MenuItem");class h extends b{constructor(e,l){const u=l.label;l.label=u,l.selected=u===e.currentResolution().label,l.selectable=!0,l.multiSelectable=!1,super(e,l),this.label=u,this.on(e,"resolutionchange",f=>this.update(f))}handleClick(e){super.handleClick(),this.player().currentResolution(this.label)}update(){const e=this.label===this.player().currentResolution().label;console.log("menuitem update",e),this.selected(e)}}h.prototype.contentElType="button",o.default.registerComponent("ResolutionMenuItem",h);const S=o.default.getComponent("MenuButton");class g extends S{constructor(e,l){super(e,l),l.title="test",this.controlText("Quality"),this.on(e,"loadstart",u=>this.updateLabel(u)),this.on(e,"updateSources",u=>{console.log("player.on('updateSources')"),this.updateLabel(u),this.update()})}createEl(){const e=super.createEl();return this.labelElId_="vjs-playback-rate-value-label-"+this.id_,this.labelEl_=o.default.dom.createEl("div",{className:"vjs-resolution-button-label",id:this.labelElId_,textContent:""}),e.appendChild(this.labelEl_),e}dispose(){super.dispose()}buildCSSClass(){return`vjs-resolution-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-resolution-button ${super.buildWrapperCSSClass()}`}createItems(){console.log("createItems"),this.sources=this.player().getGroupedSrc();const e=[],l=this.sources&&this.sources.label||{};for(let u in l)l.hasOwnProperty(u)&&(console.log(u),e.push(new h(this.player(),{label:u,src:l[u],selected:u===(this.currentSelection?this.currentSelection.label:!1)})));return e}updateLabel(){this.currentSelection=this.player().currentResolution(),this.labelEl_.textContent=this.currentSelection?this.currentSelection.label:""}}o.default.registerComponent("ResolutionMenuButton",g);const m="0.0.1";var v="";const C=o.default.getPlugin("plugin");class d extends C{constructor(e,l){super(e);const u=o.default.mergeOptions({ui:!0},l);e.updateSrc=function(t){if(!Array.isArray(t)&&t.length)return e.src();t=t.filter(function(n){try{return e.canPlayType(n.type)!==""}catch{return!0}}),this.currentSources=t.sort(f),this.groupedSrc=R(this.currentSources);let s=_(this.groupedSrc,this.currentSources);return this.currentResolutionState={label:s.label,sources:s.sources},e.trigger("updateSources"),e.setSourcesSanitized(s.sources,s.label),e.trigger("resolutionchange"),e},e.currentResolution=function(t,s){if(t==null)return this.currentResolutionState;if(!this.groupedSrc||!this.groupedSrc.label||!this.groupedSrc.label[t])return;let n=this.groupedSrc.label[t],r=e.currentTime(),p=e.paused();return!p&&this.player().options_.bigPlayButton&&this.player().bigPlayButton.hide(),e.setSourcesSanitized(n,t,s||u.customSourcePicker).one("loadeddata",function(){e.currentTime(r),p||e.play(),e.trigger("updateSources"),console.log("player.trigger('updateSources');"),e.trigger("resolutionchange")}),e},e.getGroupedSrc=function(){return this.groupedSrc},e.setSourcesSanitized=function(t,s,n){return this.currentResolutionState={label:s,sources:t},typeof n=="function"?n(e,t,s):(e.src(t.map(function(r){return{src:r.src,type:r.type,res:r.res}})),e)};function f(t,s){return!t.res||!s.res?0:+s.res-+t.res}function R(t){let s={label:{},res:{},type:{}};return t.map(function(n){for(let r in s)s[r][n[r]]==null&&(s[r][n[r]]=[]),s[r][n[r]].push(n)}),s}function _(t,s){let n=u.default,r="";return n==="high"?(n=s[0].res,r=s[0].label):n==="low"||n==null||!t.res[n]?(n=s[s.length-1].res,r=s[s.length-1].label):t.res[n]&&(r=t.res[n][0].label),{res:n,label:r,sources:t.res[n]}}if(u.ui){let t=new g(e,u);e.controlBar.el_.insertBefore(t.el_,e.controlBar.getChild("fullscreenToggle").el_)}e.options_.sources.length>1&&e.updateSrc(e.options_.sources)}dispose(){super.dispose()}}return d.defaultState={},d.VERSION=m,o.default.registerPlugin("SwitcherPlugin",d),d});
