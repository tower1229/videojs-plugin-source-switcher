(function(i,a){typeof exports=="object"&&typeof module!="undefined"?module.exports=a(require("video.js")):typeof define=="function"&&define.amd?define(["video.js"],a):(i=typeof globalThis!="undefined"?globalThis:i||self,i.lib=a(i.videojs$1))})(this,function(i){"use strict";function a(r){return r&&typeof r=="object"&&"default"in r?r:{default:r}}var c=a(i);const g=c.default.getComponent("MenuItem");class f extends g{constructor(e,o){const u=o.label;o.label=u,o.selected=u===e.currentResolution().label,o.selectable=!0,o.multiSelectable=!1,super(e,o),this.label=u,this.on(e,"resolutionchange",b=>this.update(b))}handleClick(e){super.handleClick(),this.player().currentResolution(this.label)}update(){const e=this.label===this.player().currentResolution().label;console.log("menuitem update",e),this.selected(e)}}f.prototype.contentElType="button",c.default.registerComponent("ResolutionMenuItem",f);const S=c.default.getComponent("MenuButton");class p extends S{constructor(e,o){super(e),this.controlText("Quality"),this.on(e,"loadstart",u=>this.updateLabel(u)),this.on(e,"updateSources",u=>{console.log("player.on('updateSources')"),this.updateLabel(u),this.update()})}createEl(){const e=super.createEl();return this.labelElId_="vjs-playback-rate-value-label-"+this.id_,this.labelEl_=c.default.dom.createEl("div",{className:"vjs-resolution-button-label",id:this.labelElId_,textContent:""}),e.appendChild(this.labelEl_),e}dispose(){super.dispose()}buildCSSClass(){return`vjs-resolution-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-resolution-button ${super.buildWrapperCSSClass()}`}createItems(){console.log("createItems"),this.sources=this.player().groupedSrc;const e=[],o=this.sources&&this.sources.label||{};for(let u in o)o.hasOwnProperty(u)&&(console.log(u),e.push(new f(this.player(),{label:u,src:o[u],selected:u===(this.currentSelection?this.currentSelection.label:!1)})));return e}updateLabel(){this.currentSelection=this.player().currentResolution(),this.labelEl_.textContent=this.currentSelection?this.currentSelection.label:""}}c.default.registerComponent("ResolutionMenuButton",p);const m="0.0.3";var _="";let d;window.videojs?d=window.videojs:d=c.default;const C=d.getPlugin("plugin");class h extends C{constructor(e,o={}){super(e,o),e.updateSrc=function(s){if(!Array.isArray(s)&&s.length)return e.src();s=s.filter(function(n){try{return e.canPlayType(n.type)!==""}catch{return!0}}),this.currentSources=s.sort(u),this.groupedSrc=b(this.currentSources);let t=v(this.groupedSrc,this.currentSources);return this.currentResolutionState={label:t.label,sources:t.sources},e.trigger("updateSources"),e.setSourcesSanitized(t.sources,t.label),e.trigger("resolutionchange"),e},e.currentResolution=function(s){if(s==null)return this.currentResolutionState;if(!this.groupedSrc||!this.groupedSrc.label||!this.groupedSrc.label[s])return;let t=this.groupedSrc.label[s],n=e.currentTime(),l=e.paused();return!l&&this.player().options_.bigPlayButton&&this.player().bigPlayButton.hide(),e.setSourcesSanitized(t,s).one("loadeddata",function(){e.currentTime(n),l||e.play(),e.trigger("updateSources"),console.log("player.trigger('updateSources');"),e.trigger("resolutionchange")}),e},e.setSourcesSanitized=function(s,t){return this.currentResolutionState={label:t,sources:s},e.src(s.map(function(n){return{src:n.src,type:n.type,res:n.res}})),e};function u(s,t){return!s.res||!t.res?0:+t.res-+s.res}function b(s){let t={label:{},res:{},type:{}};return s.map(function(n){for(let l in t)t[l][n[l]]==null&&(t[l][n[l]]=[]),t[l][n[l]].push(n)}),t}function v(s,t){let n=o.default||"low",l="";return n==="high"?(n=t[0].res,l=t[0].label):n==="low"||!s.res[n]?(n=t[t.length-1].res,l=t[t.length-1].label):s.res[n]&&(l=s.res[n][0].label),{res:n,label:l,sources:s.res[n]}}let R=new p(e);e.controlBar.el_.insertBefore(R.el_,e.controlBar.getChild("fullscreenToggle").el_),e.options_.sources.length>1&&e.updateSrc(e.options_.sources)}dispose(){super.dispose()}}return h.defaultState={},h.VERSION=m,d.registerPlugin("SwitcherPlugin",h),h});
