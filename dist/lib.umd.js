(function(r,a){typeof exports=="object"&&typeof module!="undefined"?module.exports=a(require("video.js")):typeof define=="function"&&define.amd?define(["video.js"],a):(r=typeof globalThis!="undefined"?globalThis:r||self,r.lib=a(r.videojs$1))})(this,function(r){"use strict";function a(i){return i&&typeof i=="object"&&"default"in i?i:{default:i}}var c=a(r);const p=c.default.getComponent("MenuItem");class f extends p{constructor(e,l){const o=l.label;l.label=o,l.selected=o===e.currentResolution().label,l.selectable=!0,l.multiSelectable=!1,super(e,l),this.label=o,this.on(e,"resolutionchange",b=>this.update(b))}handleClick(e){super.handleClick(),this.player().currentResolution(this.label)}update(){const e=this.label===this.player().currentResolution().label;console.log("menuitem update",e),this.selected(e)}}f.prototype.contentElType="button",c.default.registerComponent("ResolutionMenuItem",f);const S=c.default.getComponent("MenuButton");class g extends S{constructor(e,l){super(e),this.controlText("Quality"),this.on(e,"loadstart",o=>this.updateLabel(o)),this.on(e,"updateSources",o=>{console.log("player.on('updateSources')"),this.updateLabel(o),this.update()})}createEl(){const e=super.createEl();return this.labelElId_="vjs-playback-rate-value-label-"+this.id_,this.labelEl_=c.default.dom.createEl("div",{className:"vjs-resolution-button-label",id:this.labelElId_,textContent:""}),e.appendChild(this.labelEl_),e}dispose(){super.dispose()}buildCSSClass(){return`vjs-resolution-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-resolution-button ${super.buildWrapperCSSClass()}`}createItems(){console.log("createItems"),this.sources=this.player().groupedSrc;const e=[],l=this.sources&&this.sources.label||{};for(let o in l)l.hasOwnProperty(o)&&(console.log(o),e.push(new f(this.player(),{label:o,src:l[o],selected:o===(this.currentSelection?this.currentSelection.label:!1)})));return e}updateLabel(){this.currentSelection=this.player().currentResolution(),this.labelEl_.textContent=this.currentSelection?this.currentSelection.label:""}}c.default.registerComponent("ResolutionMenuButton",g);const m="0.0.4";var R="";let d;window.videojs?(d=window.videojs,console.warn("SwitcherPlugin:\u68C0\u6D4B\u5230window.videojs")):d=c.default;const v=d.getPlugin("plugin");class h extends v{constructor(e,l={}){super(e,l),e.updateSrc=function(s){if(!Array.isArray(s)&&s.length)return e.src();s=s.filter(function(n){try{return e.canPlayType(n.type)!==""}catch{return!0}}),this.currentSources=s.sort(o),this.groupedSrc=b(this.currentSources);let t=C(this.groupedSrc,this.currentSources);return this.currentResolutionState={label:t.label,sources:t.sources},e.trigger("updateSources"),e.setSourcesSanitized(t.sources,t.label),e.trigger("resolutionchange"),e},e.currentResolution=function(s){if(s==null)return this.currentResolutionState;if(!this.groupedSrc||!this.groupedSrc.label||!this.groupedSrc.label[s])return;let t=this.groupedSrc.label[s],n=e.currentTime(),u=e.paused();return!u&&this.player().options_.bigPlayButton&&this.player().bigPlayButton.hide(),e.setSourcesSanitized(t,s).one("loadeddata",function(){e.currentTime(n),u||e.play(),e.trigger("updateSources"),console.log("player.trigger('updateSources');"),e.trigger("resolutionchange")}),e},e.setSourcesSanitized=function(s,t){return this.currentResolutionState={label:t,sources:s},e.src(s.map(function(n){return{src:n.src,type:n.type,res:n.res}})),e};function o(s,t){return!s.res||!t.res?0:+t.res-+s.res}function b(s){let t={label:{},res:{},type:{}};return s.map(function(n){for(let u in t)t[u][n[u]]==null&&(t[u][n[u]]=[]),t[u][n[u]].push(n)}),t}function C(s,t){let n=l.default||"low",u="";return n==="high"?(n=t[0].res,u=t[0].label):n==="low"||!s.res[n]?(n=t[t.length-1].res,u=t[t.length-1].label):s.res[n]&&(u=s.res[n][0].label),{res:n,label:u,sources:s.res[n]}}let w=new g(e);e.controlBar.el_.insertBefore(w.el_,e.controlBar.getChild("fullscreenToggle").el_),e.options_.sources.length>1&&e.updateSrc(e.options_.sources)}dispose(){super.dispose()}}return h.defaultState={},h.VERSION=m,d.registerPlugin("SwitcherPlugin",h),h});
